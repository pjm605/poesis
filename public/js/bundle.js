'use strict';

var app = angular.module('myApp', ['ui.router', 'ngMessages']);

app.run(function ($rootScope, $window) {
  $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {
    console.error('Error transitioning from "' + fromState.name + '" to "' + toState.name + '":', error);
  });

  $rootScope.goBack = function () {
    $window.history.back();
  };
});

app.factory('parse', function ($http) {

  var dictionary = $http.get('/api/dictionary').then(function (response) {
    return response.data;
  });

  return function (word) {
    return dictionary.then(function (dict) {
      if (dict[word]) return dict[word];else return "Not in dictionary";
    });
  };
});

app.controller('MainCtrl', function ($scope, $log, parse, soundsFactory) {
  $scope.poem = { line: 0, word: "" };
  $scope.lineEnd = false;

  $scope.onSpace = function ($event) {
    console.log("on space event triggered");

    var words = $scope.poem.input.split(' ');
    $scope.poem.word = words[words.length - 1];
    var wordSounds = parse($scope.poem.word).then(function (p) {
      return p;
    });

    wordSounds.then(function (sounds) {
      console.log(soundsFactory.countSounds(sounds));
    });

    $scope.lineEnd = false;
  };
  $scope.onEnter = function ($event) {
    console.log("onEnter event triggered");
    $scope.lineEnd = true;
    // do anything line-dependent here?
    $scope.onSpace();
  };
});

app.factory('PhonemeFactory', function () {

  return {
    getPhonemeCount: function getPhonemeCount(word, dictionary) {
      var phonemes = dictionary[word.toLowerCase()];
      if (/\d/gi.test(word)) {
        return phonemes[1].match(/(\d)/gi).length;
      }
      return null;
    }
  };
});

app.factory('countSounds', function () {

  return function (word) {
    var newWord = word.replace(/[^A-Za-z ]+/g, '');
    newWord = newWord.split(" ");
    var soundDic = {};
    for (var i = 0; i < newWord.length; i++) {
      if (soundDic.hasOwnProperty(newWord[i]) === false) soundDic[newWord[i]] = 1;else soundDic[newWord[i]] += 1;
    }
    return soundDic;
  };
});

app.factory('soundsFactory', function () {
  var soundDic = {};
  return {
    countSounds: function countSounds(word) {
      var newWord = word.replace(/[^A-Za-z ]+/g, '');
      newWord = newWord.split(" ");
      for (var i = 0; i < newWord.length; i++) {
        if (soundDic.hasOwnProperty(newWord[i]) === false) soundDic[newWord[i]] = 1;else soundDic[newWord[i]] += 1;
      }
    },
    getSoundDic: function getSoundDic() {
      return soundDic;
    },
    identifySignificant: function identifySignificant(sounds) {
      /*
        takes in an object containing the counts of all the sounds throughout
        the poem, and returns an array of significant sounds
      */
      //TODO
      return;
    }
  };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRpY3Rpb25hcnkuZmFjdG9yeS5qcyIsIm1haW4uY29udHJvbGxlcnMuanMiLCJwaG9uZW1lRmFjdG9yeS5qcyIsInNvdW5kY291bnQuZmFjdG9yeS5qcyIsInNvdW5kcy5mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImVycm9yIiwiY29uc29sZSIsIm5hbWUiLCJnb0JhY2siLCJoaXN0b3J5IiwiYmFjayIsImZhY3RvcnkiLCIkaHR0cCIsImRpY3Rpb25hcnkiLCJnZXQiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwid29yZCIsImRpY3QiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvZyIsInBhcnNlIiwic291bmRzRmFjdG9yeSIsInBvZW0iLCJsaW5lIiwibGluZUVuZCIsIm9uU3BhY2UiLCIkZXZlbnQiLCJsb2ciLCJ3b3JkcyIsImlucHV0Iiwic3BsaXQiLCJsZW5ndGgiLCJ3b3JkU291bmRzIiwicCIsInNvdW5kcyIsImNvdW50U291bmRzIiwib25FbnRlciIsImdldFBob25lbWVDb3VudCIsInBob25lbWVzIiwidG9Mb3dlckNhc2UiLCJ0ZXN0IiwibWF0Y2giLCJuZXdXb3JkIiwicmVwbGFjZSIsInNvdW5kRGljIiwiaSIsImhhc093blByb3BlcnR5IiwiZ2V0U291bmREaWMiLCJpZGVudGlmeVNpZ25pZmljYW50Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFBQSxNQUFBQyxRQUFBQyxNQUFBLENBQUEsT0FBQSxFQUFBLENBQUEsV0FBQSxFQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUVBRixJQUFBRyxHQUFBLENBQUEsVUFBQUMsVUFBQSxFQUFBQyxPQUFBLEVBQUE7QUFDQUQsYUFBQUUsR0FBQSxDQUFBLG1CQUFBLEVB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QUFjLFdBQUEsRUFBQTtBQUNBLFNBQUEsSUFBQUMsSUFBQSxDQUFBLEVBQUFBLElBQUFILFFBQUFYLE1BQUEsRUFBQWMsR0FBQSxFQUFBO0FBQ0EsVUFBQUQsU0FBQUUsY0FBQSxDQUFBSixRQUFBRyxDQUFBLENBQUEsTUFBQSxLQUFBLEVBQUFELFNBQUFGLFFBQUFHLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxLQUNBRCxTQUFBRixRQUFBRyxDQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0E7QUFDQSxXQUFBRCxRQUFBO0FBQ0EsR0FUQTtBQVVBLENBWkE7O0FDQUF0RCxJQUFBa0IsT0FBQSxDQUFBLGVBQUEsRUFBQSxZQUFBO0FBQ0EsTUFBQW9DLFdBQUEsRUFBQTtBQUNBLFNBQUE7QUFDQVQsaUJBQUEscUJBQUFwQixJQUFBLEVBQUE7QUFDQSxVQUFBMkIsVUFBQTNCLEtBQUE0QixPQUFBLENBQUEsY0FBQSxFQUFBLEVBQUEsQ0FBQTtBQUNBRCxnQkFBQUEsUUFBQVosS0FBQSxDQUFBLEdBQUEsQ0FBQTtBQUNBLFdBQUEsSUFBQWUsSUFBQSxDQUFBLEVBQUFBLElBQUFILFFBQUFYLE1BQUEsRUFBQWMsR0FBQSxFQUFBO0FBQ0EsWUFBQUQsU0FBQUUsY0FBQSxDQUFBSixRQUFBRyxDQUFBLENBQUEsTUFBQSxLQUFBLEVBQUFELFNBQUFGLFFBQUFHLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxLQUNBRCxTQUFBRixRQUFBRyxDQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0E7QUFDQSxLQVJBO0FBU0FFLGlCQUFBLHVCQUFBO0FBQ0EsYUFBQUgsUUFBQTtBQUNBLEtBWEE7QUFZQUkseUJBQUEsNkJBQUFkLE1BQUEsRUFBQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBbkJBLEdBQUE7QUFxQkEsQ0F2QkEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJywgWyd1aS5yb3V0ZXInLCAnbmdNZXNzYWdlcyddKTtcblxuYXBwLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHdpbmRvdykge1xuICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdHJhbnNpdGlvbmluZyBmcm9tIFwiJyArIGZyb21TdGF0ZS5uYW1lICsgJ1wiIHRvIFwiJyArIHRvU3RhdGUubmFtZSArICdcIjonLCBlcnJvcik7XG4gIH0pO1xuXG4gICRyb290U2NvcGUuZ29CYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICR3aW5kb3cuaGlzdG9yeS5iYWNrKClcbiAgfTtcblxufSk7XG4iLCJhcHAuZmFjdG9yeSgncGFyc2UnLCBmdW5jdGlvbigkaHR0cCkge1xuXG4gIHZhciBkaWN0aW9uYXJ5ID0gJGh0dHAuZ2V0KCcvYXBpL2RpY3Rpb25hcnknKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICByZXR1cm4gZnVuY3Rpb24gKHdvcmQpIHtcbiAgICByZXR1cm4gZGljdGlvbmFyeS50aGVuKGZ1bmN0aW9uIChkaWN0KSB7XG4gICAgICBpZiAoZGljdFt3b3JkXSkgcmV0dXJuIGRpY3Rbd29yZF07XG4gICAgICBlbHNlIHJldHVybiBcIk5vdCBpbiBkaWN0aW9uYXJ5XCI7XG4gICAgfSlcbiAgfVxufSk7XG4iLCJhcHAuY29udHJvbGxlcignTWFpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2csIHBhcnNlLCBzb3VuZHNGYWN0b3J5KSB7XG4gICRzY29wZS5wb2VtID0ge2xpbmU6IDAsIHdvcmQ6IFwiXCJ9O1xuICAkc2NvcGUubGluZUVuZCA9IGZhbHNlO1xuXG4gICRzY29wZS5vblNwYWNlID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgIGNvbnNvbGUubG9nKFwib24gc3BhY2UgZXZlbnQgdHJpZ2dlcmVkXCIpO1xuXG4gICAgdmFyIHdvcmRzID0gJHNjb3BlLnBvZW0uaW5wdXQuc3BsaXQoJyAnKTtcbiAgICAkc2NvcGUucG9lbS53b3JkID0gd29yZHNbd29yZHMubGVuZ3RoLTFdO1xuICAgIHZhciB3b3JkU291bmRzID0gcGFyc2UoJHNjb3BlLnBvZW0ud29yZCkudGhlbihmdW5jdGlvbiAocCkge1xuICAgICAgcmV0dXJuIHA7XG4gICAgfSlcblxuICAgIHdvcmRTb3VuZHMudGhlbihmdW5jdGlvbiAoc291bmRzKSB7XG4gICAgICBjb25zb2xlLmxvZyhzb3VuZHNGYWN0b3J5LmNvdW50U291bmRzKHNvdW5kcykpO1xuICAgIH0pXG5cbiAgICAkc2NvcGUubGluZUVuZCA9IGZhbHNlO1xuICB9XG4gICRzY29wZS5vbkVudGVyID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgIGNvbnNvbGUubG9nKFwib25FbnRlciBldmVudCB0cmlnZ2VyZWRcIik7XG4gICAgJHNjb3BlLmxpbmVFbmQgPSB0cnVlO1xuICAgIC8vIGRvIGFueXRoaW5nIGxpbmUtZGVwZW5kZW50IGhlcmU/XG4gICAgJHNjb3BlLm9uU3BhY2UoKTtcbiAgfVxufSk7XG4iLCJhcHAuZmFjdG9yeSgnUGhvbmVtZUZhY3RvcnknLCBmdW5jdGlvbiAoKSB7XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRQaG9uZW1lQ291bnQ6IGZ1bmN0aW9uICh3b3JkLCBkaWN0aW9uYXJ5KSB7XG4gICAgICB2YXIgcGhvbmVtZXMgPSBkaWN0aW9uYXJ5W3dvcmQudG9Mb3dlckNhc2UoKV07XG4gICAgICBpZiAoL1xcZC9naS50ZXN0KHdvcmQpKXtcbiAgICAgICAgcmV0dXJuIHBob25lbWVzWzFdLm1hdGNoKC8oXFxkKS9naSkubGVuZ3RoO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG59KTtcbiIsImFwcC5mYWN0b3J5KCdjb3VudFNvdW5kcycsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgICB2YXIgbmV3V29yZCA9IHdvcmQucmVwbGFjZSgvW15BLVphLXogXSsvZywgJycpO1xuICAgICAgbmV3V29yZCA9IG5ld1dvcmQuc3BsaXQoXCIgXCIpO1xuICAgICAgdmFyIHNvdW5kRGljID0ge307XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1dvcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYoc291bmREaWMuaGFzT3duUHJvcGVydHkobmV3V29yZFtpXSkgPT09IGZhbHNlKSBzb3VuZERpY1tuZXdXb3JkW2ldXSA9IDE7XG4gICAgICAgIGVsc2Ugc291bmREaWNbbmV3V29yZFtpXV0gKz0gMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzb3VuZERpYztcbiAgfTtcbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ3NvdW5kc0ZhY3RvcnknLCBmdW5jdGlvbiAoKSB7XG4gIHZhciBzb3VuZERpYyA9IHt9O1xuICByZXR1cm4ge1xuICAgICAgY291bnRTb3VuZHM6IGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgICAgIHZhciBuZXdXb3JkID0gd29yZC5yZXBsYWNlKC9bXkEtWmEteiBdKy9nLCAnJyk7XG4gICAgICAgIG5ld1dvcmQgPSBuZXdXb3JkLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZXdXb3JkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYoc291bmREaWMuaGFzT3duUHJvcGVydHkobmV3V29yZFtpXSkgPT09IGZhbHNlKSBzb3VuZERpY1tuZXdXb3JkW2ldXSA9IDE7XG4gICAgICAgICAgZWxzZSBzb3VuZERpY1tuZXdXb3JkW2ldXSArPSAxO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZ2V0U291bmREaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNvdW5kRGljO1xuICAgICAgfSxcbiAgICAgIGlkZW50aWZ5U2lnbmlmaWNhbnQ6IGZ1bmN0aW9uIChzb3VuZHMpIHtcbiAgICAgICAgLypcbiAgICAgICAgICB0YWtlcyBpbiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY291bnRzIG9mIGFsbCB0aGUgc291bmRzIHRocm91Z2hvdXRcbiAgICAgICAgICB0aGUgcG9lbSwgYW5kIHJldHVybnMgYW4gYXJyYXkgb2Ygc2lnbmlmaWNhbnQgc291bmRzXG4gICAgICAgICovXG4gICAgICAgIC8vVE9ET1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9O1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
