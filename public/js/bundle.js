'use strict';

var app = angular.module('myApp', ['ui.router', 'ngMessages']);

app.run(function ($rootScope, $window) {
  $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {
    console.error('Error transitioning from "' + fromState.name + '" to "' + toState.name + '":', error);
  });

  $rootScope.goBack = function () {
    $window.history.back();
  };
});

app.factory('parse', function ($http) {

  var dictionary = $http.get('/api/dictionary').then(function (response) {
    return response.data;
  });

  return function (word) {
    return dictionary.then(function (dict) {
      if (dict[word]) return dict[word];else return "Not in dictionary";
    });
  };
});

app.controller('MainCtrl', function ($scope, $log, parse, soundsFactory) {
  $scope.poem = { line: 0, word: "" };
  $scope.lineEnd = false;

  $scope.onSpace = function ($event) {
    console.log("on space event triggered");

    var words = $scope.poem.input.split(' ');
    $scope.poem.word = words[words.length - 1];
    var wordSounds = parse($scope.poem.word).then(function (p) {
      return p;
    });

    wordSounds.then(function (sounds) {
      console.log(soundsFactory.countSounds(sounds));
    });

    $scope.lineEnd = false;
  };
  $scope.onEnter = function ($event) {
    console.log("onEnter event triggered");
    $scope.lineEnd = true;
    // do anything line-dependent here?
    $scope.onSpace();
  };
});

app.factory('PhonemeFactory', function () {

  return {
    getPhonemeCount: function getPhonemeCount(word, dictionary) {
      var phonemes = dictionary[word.toLowerCase()];
      if (/\d/gi.test(word)) {
        return phonemes[1].match(/(\d)/gi).length;
      }
      return null;
    }
  };
});

app.factory('countSounds', function () {

  return function (word) {
    var newWord = word.replace(/[^A-Za-z ]+/g, '');
    newWord = newWord.split(" ");
    var soundDic = {};
    for (var i = 0; i < newWord.length; i++) {
      if (soundDic.hasOwnProperty(newWord[i]) === false) soundDic[newWord[i]] = 1;else soundDic[newWord[i]] += 1;
    }
    return soundDic;
  };
});

app.factory('soundsFactory', function () {
  return {
    countSounds: function countSounds(word) {
      var newWord = word.replace(/[^A-Za-z ]+/g, '');
      newWord = newWord.split(" ");
      var soundDic = {};
      for (var i = 0; i < newWord.length; i++) {
        if (soundDic.hasOwnProperty(newWord[i]) === false) soundDic[newWord[i]] = 1;else soundDic[newWord[i]] += 1;
      }
      return soundDic;
    },
    identifySignificant: function identifySignificant(sounds) {
      /*
        takes in an object containing the counts of all the sounds throughout
        the poem, and returns an array of significant sounds
      */
    }
  };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRpY3Rpb25hcnkuZmFjdG9yeS5qcyIsIm1haW4uY29udHJvbGxlcnMuanMiLCJwaG9uZW1lRmFjdG9yeS5qcyIsInNvdW5kY291bnQuZmFjdG9yeS5qcyIsInNvdW5kcy5mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImVycm9yIiwiY29uc29sZSIsIm5hbWUiLCJnb0JhY2siLCJoaXN0b3J5IiwiYmFjayIsImZhY3RvcnkiLCIkaHR0cCIsImRpY3Rpb25hcnkiLCJnZXQiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwid29yZCIsImRpY3QiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvZyIsInBhcnNlIiwic291bmRzRmFjdG9yeSIsInBvZW0iLCJsaW5lIiwibGluZUVuZCIsIm9uU3BhY2UiLCIkZXZlbnQiLCJsb2ciLCJ3b3JkcyIsImlucHV0Iiwic3BsaXQiLCJsZW5ndGgiLCJ3b3JkU291bmRzIiwicCIsInNvdW5kcyIsImNvdW50U291bmRzIiwib25FbnRlciIsImdldFBob25lbWVDb3VudCIsInBob25lbWVzIiwidG9Mb3dlckNhc2UiLCJ0ZXN0IiwibWF0Y2giLCJuZXdXb3JkIiwicmVwbGFjZSIsInNvdW5kRGljIiwiaSIsImhhc093blByb3BlcnR5IiwiaWRlbnRpZnlTaWduaWZpY2FudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBQUEsTUFBQUMsUUFBQUMsTUFBQSxDQUFBLE9BQUEsRUFBQSxDQUFBLFdBQUEsRUFBQSxZQUFBLENBQUEsQ0FBQTs7QUFFQUYsSUFBQUcsR0FBQSxDQUFBLFVBQUFDLFVBQUEsRUFBQUMsT0FBQSxFQUFBO0FBQ0FELGFBQUFFLEdBQUEsQ0FBQSxtQkFBQSxFQUFBLFVBQUFDLEtBQUEs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QUFDQSxTQUFBLElBQUFDLElBQUEsQ0FBQSxFQUFBQSxJQUFBSCxRQUFBWCxNQUFBLEVBQUFjLEdBQUEsRUFBQTtBQUNBLFVBQUFELFNBQUFFLGNBQUEsQ0FBQUosUUFBQUcsQ0FBQSxDQUFBLE1BQUEsS0FBQSxFQUFBRCxTQUFBRixRQUFBRyxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsS0FDQUQsU0FBQUYsUUFBQUcsQ0FBQSxDQUFBLEtBQUEsQ0FBQTtBQUNBO0FBQ0EsV0FBQUQsUUFBQTtBQUNBLEdBVEE7QUFVQSxDQVpBOztBQ0FBdEQsSUFBQWtCLE9BQUEsQ0FBQSxlQUFBLEVBQUEsWUFBQTtBQUNBLFNBQUE7QUFDQTJCLGlCQUFBLHFCQUFBcEIsSUFBQSxFQUFBO0FBQ0EsVUFBQTJCLFVBQUEzQixLQUFBNEIsT0FBQSxDQUFBLGNBQUEsRUFBQSxFQUFBLENBQUE7QUFDQUQsZ0JBQUFBLFFBQUFaLEtBQUEsQ0FBQSxHQUFBLENBQUE7QUFDQSxVQUFBYyxXQUFBLEVBQUE7QUFDQSxXQUFBLElBQUFDLElBQUEsQ0FBQSxFQUFBQSxJQUFBSCxRQUFBWCxNQUFBLEVBQUFjLEdBQUEsRUFBQTtBQUNBLFlBQUFELFNBQUFFLGNBQUEsQ0FBQUosUUFBQUcsQ0FBQSxDQUFBLE1BQUEsS0FBQSxFQUFBRCxTQUFBRixRQUFBRyxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsS0FDQUQsU0FBQUYsUUFBQUcsQ0FBQSxDQUFBLEtBQUEsQ0FBQTtBQUNBO0FBQ0EsYUFBQUQsUUFBQTtBQUNBLEtBVkE7QUFXQUcseUJBQUEsNkJBQUFiLE1BQUEsRUFBQTtBQUNBOzs7O0FBSUE7QUFoQkEsR0FBQTtBQWtCQSxDQW5CQSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnLCBbJ3VpLnJvdXRlcicsICduZ01lc3NhZ2VzJ10pO1xuXG5hcHAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkd2luZG93KSB7XG4gICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB0cmFuc2l0aW9uaW5nIGZyb20gXCInICsgZnJvbVN0YXRlLm5hbWUgKyAnXCIgdG8gXCInICsgdG9TdGF0ZS5uYW1lICsgJ1wiOicsIGVycm9yKTtcbiAgfSk7XG5cbiAgJHJvb3RTY29wZS5nb0JhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgJHdpbmRvdy5oaXN0b3J5LmJhY2soKVxuICB9O1xuXG59KTtcbiIsImFwcC5mYWN0b3J5KCdwYXJzZScsIGZ1bmN0aW9uKCRodHRwKSB7XG5cbiAgdmFyIGRpY3Rpb25hcnkgPSAkaHR0cC5nZXQoJy9hcGkvZGljdGlvbmFyeScpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gIHJldHVybiBmdW5jdGlvbiAod29yZCkge1xuICAgIHJldHVybiBkaWN0aW9uYXJ5LnRoZW4oZnVuY3Rpb24gKGRpY3QpIHtcbiAgICAgIGlmIChkaWN0W3dvcmRdKSByZXR1cm4gZGljdFt3b3JkXTtcbiAgICAgIGVsc2UgcmV0dXJuIFwiTm90IGluIGRpY3Rpb25hcnlcIjtcbiAgICB9KVxuICB9XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdNYWluQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJGxvZywgcGFyc2UsIHNvdW5kc0ZhY3RvcnkpIHtcbiAgJHNjb3BlLnBvZW0gPSB7bGluZTogMCwgd29yZDogXCJcIn07XG4gICRzY29wZS5saW5lRW5kID0gZmFsc2U7XG5cbiAgJHNjb3BlLm9uU3BhY2UgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJvbiBzcGFjZSBldmVudCB0cmlnZ2VyZWRcIik7XG5cbiAgICB2YXIgd29yZHMgPSAkc2NvcGUucG9lbS5pbnB1dC5zcGxpdCgnICcpO1xuICAgICRzY29wZS5wb2VtLndvcmQgPSB3b3Jkc1t3b3Jkcy5sZW5ndGgtMV07XG4gICAgdmFyIHdvcmRTb3VuZHMgPSBwYXJzZSgkc2NvcGUucG9lbS53b3JkKS50aGVuKGZ1bmN0aW9uIChwKSB7XG4gICAgICByZXR1cm4gcDtcbiAgICB9KVxuXG4gICAgd29yZFNvdW5kcy50aGVuKGZ1bmN0aW9uIChzb3VuZHMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHNvdW5kc0ZhY3RvcnkuY291bnRTb3VuZHMoc291bmRzKSk7XG4gICAgfSlcblxuICAgICRzY29wZS5saW5lRW5kID0gZmFsc2U7XG4gIH1cbiAgJHNjb3BlLm9uRW50ZXIgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJvbkVudGVyIGV2ZW50IHRyaWdnZXJlZFwiKTtcbiAgICAkc2NvcGUubGluZUVuZCA9IHRydWU7XG4gICAgLy8gZG8gYW55dGhpbmcgbGluZS1kZXBlbmRlbnQgaGVyZT9cbiAgICAkc2NvcGUub25TcGFjZSgpO1xuICB9XG59KTtcbiIsImFwcC5mYWN0b3J5KCdQaG9uZW1lRmFjdG9yeScsIGZ1bmN0aW9uICgpIHtcblxuICByZXR1cm4ge1xuICAgIGdldFBob25lbWVDb3VudDogZnVuY3Rpb24gKHdvcmQsIGRpY3Rpb25hcnkpIHtcbiAgICAgIHZhciBwaG9uZW1lcyA9IGRpY3Rpb25hcnlbd29yZC50b0xvd2VyQ2FzZSgpXTtcbiAgICAgIGlmICgvXFxkL2dpLnRlc3Qod29yZCkpe1xuICAgICAgICByZXR1cm4gcGhvbmVtZXNbMV0ubWF0Y2goLyhcXGQpL2dpKS5sZW5ndGg7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ2NvdW50U291bmRzJywgZnVuY3Rpb24gKCkge1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHdvcmQpIHtcbiAgICAgIHZhciBuZXdXb3JkID0gd29yZC5yZXBsYWNlKC9bXkEtWmEteiBdKy9nLCAnJyk7XG4gICAgICBuZXdXb3JkID0gbmV3V29yZC5zcGxpdChcIiBcIik7XG4gICAgICB2YXIgc291bmREaWMgPSB7fTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3V29yZC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZihzb3VuZERpYy5oYXNPd25Qcm9wZXJ0eShuZXdXb3JkW2ldKSA9PT0gZmFsc2UpIHNvdW5kRGljW25ld1dvcmRbaV1dID0gMTtcbiAgICAgICAgZWxzZSBzb3VuZERpY1tuZXdXb3JkW2ldXSArPSAxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNvdW5kRGljO1xuICB9O1xufSk7XG4iLCJhcHAuZmFjdG9yeSgnc291bmRzRmFjdG9yeScsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICAgIGNvdW50U291bmRzOiBmdW5jdGlvbiAod29yZCkge1xuICAgICAgICB2YXIgbmV3V29yZCA9IHdvcmQucmVwbGFjZSgvW15BLVphLXogXSsvZywgJycpO1xuICAgICAgICBuZXdXb3JkID0gbmV3V29yZC5zcGxpdChcIiBcIik7XG4gICAgICAgIHZhciBzb3VuZERpYyA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1dvcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZihzb3VuZERpYy5oYXNPd25Qcm9wZXJ0eShuZXdXb3JkW2ldKSA9PT0gZmFsc2UpIHNvdW5kRGljW25ld1dvcmRbaV1dID0gMTtcbiAgICAgICAgICBlbHNlIHNvdW5kRGljW25ld1dvcmRbaV1dICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNvdW5kRGljO1xuICAgICAgfSxcbiAgICAgIGlkZW50aWZ5U2lnbmlmaWNhbnQ6IGZ1bmN0aW9uIChzb3VuZHMpIHtcbiAgICAgICAgLypcbiAgICAgICAgICB0YWtlcyBpbiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY291bnRzIG9mIGFsbCB0aGUgc291bmRzIHRocm91Z2hvdXRcbiAgICAgICAgICB0aGUgcG9lbSwgYW5kIHJldHVybnMgYW4gYXJyYXkgb2Ygc2lnbmlmaWNhbnQgc291bmRzXG4gICAgICAgICovXG4gICAgICB9XG4gICAgfTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
